@model IEnumerable<DoAnCoSo.ViewModels.InventoryDashboardViewModel>
@{
    ViewData["Title"] = "📦 Quản lý kho";
}

<div class="container py-4">
    <h2 class="mb-4 text-center text-primary">📊 Bảng tồn kho</h2>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
    }

    <table class="table table-bordered table-striped align-middle">
        <thead class="table-light">
            <tr class="text-center">
                <th>#</th>
                <th>Tên sản phẩm</th>
                <th>Tồn kho</th>
                <th>Đã bán</th>
                <th>Giữ tạm</th>
                <th>Ngưỡng cảnh báo</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            @if (!Model.Any())
            {
                <tr><td colspan="7" class="text-center text-muted">Không có sản phẩm nào.</td></tr>
            }
            else
            {
                int i = 1;
                foreach (var p in Model)
                {
                    <tr class="@(p.IsLowStock ? "table-warning" : "")">
                        <td class="text-center">@i</td>
                        <td>@p.ProductName</td>
                        <td class="text-center fw-bold">@p.StockQuantity</td>
                        <td class="text-center text-success">@p.SoldQuantity</td>
                        <td class="text-center text-info">@p.ReservedQuantity</td>
                        <td class="text-center">@p.LowStockThreshold</td>
                        <td class="text-center">

                            <!-- Nhập kho -->
                            <form asp-action="ImportStock" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="productId" value="@p.ProductId" />

                                <input type="number"
                                       name="quantity"
                                       min="1"
                                       class="form-control d-inline-block"
                                       style="width:80px"
                                       placeholder="SL" />

                                <input type="text"
                                       name="note"
                                       class="form-control d-inline-block ms-1"
                                       style="width:200px"
                                       placeholder="Ghi chú (vd: nhập lô 11/2025)" />

                                <button type="submit" class="btn btn-sm btn-success ms-1">
                                    + Nhập
                                </button>
                            </form>

                            <!-- Xuất/Điều chỉnh -->
                            <form asp-action="ExportStock" method="post" class="d-inline ms-2">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="productId" value="@p.ProductId" />

                                <input type="number"
                                       name="quantity"
                                       min="1"
                                       class="form-control d-inline-block"
                                       style="width:80px"
                                       placeholder="SL" />

                                <input type="text"
                                       name="note"
                                       class="form-control d-inline-block ms-1"
                                       style="width:200px"
                                       placeholder="Ghi chú (vd: điều chỉnh hỏng)" />

                                <button type="submit" class="btn btn-sm btn-danger ms-1">
                                    - Xuất
                                </button>
                            </form>

                        </td>

                    </tr>
                    i++;
                }
            }
        </tbody>
    </table>

    <div class="text-center mt-3">
        <a asp-action="Logs" class="btn btn-outline-secondary">📜 Xem lịch sử kho</a>
    </div>
</div>

<!-- Auto-hide message -->
<script>
    setTimeout(() => {
        document.querySelectorAll('.alert').forEach(a => a.remove());
    }, 3000);
</script>
<style>
    @@media (max-width: 768px) {
        .table .form-control

    {
        width: 140px !important;
    }

    }
</style>
